{% extends "ZoomAA/layout.html" %}

{% block body %}
<h1 class="display-3">RT Attendance Tracker</h1>
<h3>Grade {{ grade }}</h3>
<hr>
{% if message %}
<div class="alert alert-success" role="alert">
    {{ message }}
</div>
{% endif %}
{% if data %}
<table class="table table-hover lead" id="atTbl">
    <thead>
        <th scope="col">Sl No.</th>
        <th scope="col">Name</th>
        <th scope="col">Attendance</th>
    </thead>
    <tbody>
        {% for list in data %}
        <tr>
            {% for item in list %}
            <td>{{ item }}</td>
            {% endfor %}
            <td class="row align-items-center">
                <div class="form-check col">
                    <input class="form-check-input" type="radio" name="{{ list.0 }}" value="Present+{{ list.0 }}"
                        id="Present">
                    <label class="form-check-label" for="Present">
                        Mark Present & Send SMS
                    </label>
                </div>
                <div class="form-check col">
                    <input class="form-check-input" type="radio" name="{{ list.0 }}" value="AbsentSMS+{{ list.0 }}"
                        id="AbsentSMS">
                    <label class="form-check-label" for="AbsentSMS">
                        Mark Absent & Send SMS
                    </label>
                </div>
                <div class="form-check col">
                    <input class="form-check-input" type="radio" name="{{ list.0 }}" value="Absent+{{ list.0 }}"
                        id="Absent">
                    <label class="form-check-label" for="Absent">
                        Mark Absent
                    </label>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}
<div class="col-2">
    <button class="btn btn-success mb-2" type="submit" onclick="validate()">Submit</button>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script>
    function validate() {

        //Reference the table
        var summarytbl = document.getElementById("atTbl");


        //Reference all the checkboxes in Table.
        var chks = summarytbl.getElementsByTagName("INPUT");

        //Loop and store index of checked boxes
        const chkIndex = [];
        for (var i = 0; i < chks.length; i++) {

            if (chks[i].checked) {
                chkIndex.push(chks[i].value);
            }
        }

        let data = new FormData(); // 2

        data.append("arr", chkIndex)
        data.append("csrfmiddlewaretoken", '{{csrf_token}}')

        axios.post("", data) // 4
            .then(res => { alert("SMS being sent out."); location.reload(true); }) // 5
            .catch(errors => console.log(errors)) // 6
    };
</script>
{% endblock %}